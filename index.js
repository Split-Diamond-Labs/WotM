function capitalizeFirst(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

function toggleDark() {
  const style = document.getElementsByClassName("body")[0].style;
  style.filter = style.filter == "invert(1)" ? "invert(0)" : "invert(1)";
}

function refresh() {
  document.getElementById("title").innerText = rooms[currentRoom].name;
  document.getElementById("description").innerHTML = rooms[currentRoom].description;
  
  let itemss = document.getElementById("items");
  
  itemss.innerHTML = "";
  
  let DOMString = `<h3 style='text-align: center;'>${rooms[currentRoom].name}</h3>`;
  
  for (const item of rooms[currentRoom].items) {
    DOMString += `<span style="font-size: 2.5vh; margin-left: 0.5vh;">${capitalizeFirst(items[item].name)}</span>
    <button style="padding-top: 0.2vw; padding-bottom: 0.2vw;" id="${item}" onclick='(function(e) { items["${item}"].onGrab(); inventory.push("${item}"); rooms[currentRoom].items = rooms[currentRoom].items.filter(element => element != "${item}"); refresh(); notify(\`You picked up the ${items[item].name}.\`); })(this)'>Take</button>
    <br>`;
  }

  itemss.innerHTML = DOMString;

  let items2 = document.getElementById("room-items");
  DOMString = "<h3 style='text-align: center;'>Inventory</h3>";
  
  for (const item of inventory) {
    DOMString += `<span style="font-size: 2.5vh; margin-left: 0.5vh;">${capitalizeFirst(items[item].name)}</span>
    <button style="padding-top: 0.2vw; padding-bottom: 0.2vw;" id="${item}" onclick='(function(e) { items["${item}"].onDrop(); rooms[currentRoom].items.push("${item}"); inventory = inventory.filter(element => element != "${item}"); refresh(); notify(\`You dropped your ${items[item].name}.\`); })(this)'>Drop</button>
    <button style="padding-top: 0.2vw; padding-bottom: 0.2vw;" id="${item}use" onclick='(function(e) { items["${item}"].onUse(); refresh(); })(this)'>Use</button>
    <br>`;
  }
  
  items2.innerHTML = DOMString;

  let items3 = document.getElementById("exits");
  DOMString = "";
  
  for (const path in rooms[currentRoom].exits) {
    DOMString += `
    <button id=${path} onclick="exit('${path}')">Go ${path}${rooms[currentRoom].exits[path].locked ? " (locked)" : ""}</button>`;
  }
  
  items3.innerHTML = DOMString;
}

function notify(message) {
  document.getElementById("notify").innerText = message;
  document.getElementById("notify").style.backgroundColor = "black";
  document.getElementById("notify").style.color = "white";
  setTimeout(() =>  { document.getElementById("notify").style.backgroundColor = "white"; document.getElementById("notify").style.color = "black"; }, 500);
}



function exit (direction) {
  if (!rooms[currentRoom].exits[direction]) return;
  if (rooms[currentRoom].exits[direction].locked) {
    notify("That way is locked.");
    return;
  }
  currentRoom = rooms[currentRoom].exits[direction].to;
  $(".room-details").fadeOut(1000, () => {
    notify(`You went ${direction}...`);
    refresh();
    $(".room-details").fadeIn(1000);
  });
};

let currentRoom = "forest";

let inventory = [
  
];

let handsome = `
...........................................................................,,*(#%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%#(/*,......................................................................
.................................................................,,*/((#%&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%##(/*,,............................................................
.............................................................,/#%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%#/,........................................................
......................................................,,*/(%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%#(**,.................................................
...................................................*(%&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%%#((///////******//////((##%%&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&%(*..............................................
..............................................,/(#&&@@@@@@@@@@@@@@@@@@@&&&&%%##((//*,,,,,,,,,,,,,,,********************/////((##%%%&&&&@@@@@@@@@@@@@@@@@@&&%(/,.........................................
...........................................,/%&&@@@@@@@@@@@@@@@@@@@@&&%(/********,,,...........,...,,*****************/////******/////(#%&&@@@@@@@@@@@@@@@@@@&&%(*......................................
.......................................,/#%&@@@@@@@@@@@@@@@@@&&%##(/***************,,................,*******,**,*****//////////*//*******/((#%&&&@@@@@@@@@@@@@@@&%#/,..................................
....................................,*#&&@@@@@@@@@@@@@@@@&&%/*,,*********************,..............,,*****,,,*****,*****///////*///***,,*******/(#&&@@@@@@@@@@@@@@@&&%/,...............................
.................................,/(%&@@@@@@@@@@@@@@@&%#(/,,,,***///////////////////*****,,,,,,,,,,,,,,*************,,,**********////****/******//***/(#%&@@@@@@@@@@@@@&%#/,............................
.............................../#&&@@@@@@@@@@@@@@&&%#(////////////////////////////////////*******,,,,,,,*******,,,,,,,,,,***,...,,**//**////***//**..    ,(%&@@@@@@@@@@@@@&&#/..........................
...........................,*(%&@@@@@@@@@@@@@@&%#(////////******,,,.,,......,,,,,,,,*****,,,,,,,,,,,,,,,,,,,,,,,,******,,,,,,........,,**////////**,.      .,/#&&@@@@@@@@@@@@&&(*,......................
........................../#&&@@@@@@@@@@@@@@%/*,,**/////****,,,,,.................,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********,,,,,,..........,**/////////*,.        ../#&@@@@@@@@@@@@&&%/.....................
.......................,/%&@@@@@@@@@@@@@&%(*....,**//*********////////////******,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,********,,**,,,,,,**************////*,..         .,/(%&@@@@@@@@@@@@&%(*..................
.....................*/%&@@@@@@@@@@@@@&#*.   ...,,***,........,*************,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*******************////************//**,.          ..,,*(%&@@@@@@@@@@@&%(*................
...................,/%&@@@@@@@@@@@@&%(,.     ....,,,,....... ..,********,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,****************///////*************/***,.         .......,/#&@@@@@@@@@@@&%(*..............
.................,(%&@@@@@@@@@@@@@%/,.       .....,,,......  ..,,******,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*******************////*****///////****,..         ...,,.   .*(&@@@@@@@@@@@&%(,............
................/#&@@@@@@@@@@@@&%/,,....       .................,,,,***,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*******************/*//**********,,,......         ...,,,.     .*(&&@@@@@@@@@@&%/,..........
..............*#&@@@@@@@@@@@@&%/..,,,,......       ......      .,,,*,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,******************////***,,,.....                 ...,,**,.      .,(&&@@@@@@@@@@&#*.........
............,/%&@@@@@@@@@@@&%(,.  .,,,,,......         ........,,,***,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*********************///**,..                      ...,,***,.        .*#&@@@@@@@@@@@%(,.......
...........*#&@@@@@@@@@@@@%#,     .,,**,,......         ..,,,*******,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,**************************/////*,..                    ...,,****,.          ./&&@@@@@@@@@@&#/......
.........,*#@@@@@@@@@@@@&%/.       .,****,,,....      ...,,*******,,,,,,,,,,,,,,,,,,,,,,......,,,,,***************************////////*,.                 ....,**///*,.           .,(&&@@@@@@@@@@%/,....
........,/&&@@@@@@@@@@&&(..        .,*///**,,,...  ....,,,*************,,,,,,,,,,,,,,,..     .,,,,,***************************//////////*,,,.           ....,,*////*,.              .*%&@@@@@@@@@&&(,...
.......,(%@@@@@@@@@@@&%/,          .,**/////**,,,,,,,,,*****************,,,,,,,,,,*,,,..     .,,,,****************************//////////*,,..         ....,,*//((//,.                .*(&@@@@@@@@@@%#*..
......*(&@@@@@@@@@@@@#/.            .,***//////*******************************,*,**,,,..    ..,,,*****************************//////////*,,,.        ...,,*//(((/*,.                   ,#%@@@@@@@@@@&(*.
.....,(&&@@@@@@@@@@&%*              .,***,.,**/(//////*****************************,,,,.....,,,*******************************///////////**,...  ....,,**//((((/*..                     .(&&@@@@@@@@&&#,
....*(%@@@@@@@@@@&&#.               .,**,.  .,*((((///*****************************,,,,,,,,,,,******************************//////////////***,,..,,,,**//((((/*,.                        ./%@@@@@@@@@@%(
...,/&&@@@@@@@@@@&#*                 .,,.   .,*/((//***********************************************************************///////////////////*****///(((((*,.                            ,(%&@@@@@@@@&&
..,/%@@@@@@@@@@@&%,                   ..    .,,*************************************************************************////////////////((((((((((((((((/*,.                              .*(&@@@@@@@@@@
..*#&@@@@@@@@@@@#*.                         .,*///********************************************************************//////////////////((((((######(/,.                                 ...*#&@@@@@@@@@
.,/%@@@@@@@@@@@&/                       .  .,**////////**************************,,,,,,*********************************////////////////((((((#####(/..                              ..,,,,..,#@@@@@@@@@
./%&@@@@@@@@@@&#*                         .,*//**/////////****///****************************************************************/////////////((((((*.                           ..,,,,,,,,.  /&&@@@@@@@
.(&&@@@@@@@@@@%*.                         .,*///////////******/////////********/////*///***/*//////////////////////////////////////////(((((((((###(*..                    ..,..,,,***,.,,,.  ,(%@@@@@@@
*#@@@@@@@@@@@&#*,,..                       .,/(#(((/////////////////////*******/////////////*****//////////////////////////((((((((((((((###########/,.                    .,,,,,,,,,,,,,,,.  .,%@@@@@@@
/%@@@@@@@@@@&%(*,,,.                       .,/(((((/////((##((///////////(((((///////////////**/////////////////***////((((((((((////(((######((((##(*,.                    ,,*,,.......,,,.   .#&@@@@@@
#%@@@@@@@@@@&#/,,,,.                       .,//((((((////(((///////////(((##(((////////////((((((((////////////////((((((((((((((////((#######((((###(*..                   .,*,,,,,,..,,,,.   .(%&@@@@@
%&@@@@@@@@@@&/*,,,..                         .*/(##((((((((((//////////////////////////////(((#((((//////////(((#####((((((((((((##############%%%#(/*.                     .,*,,,,,,,,,,,,.   ./%&@@@@@
%&@@@@@@@@@@&/,,,,..                           .,*/(######(((((((((((((((((((((((((((((////(/((((/(((((((((((((((((((((((((((###############%%%%%%(*..                       .*****,,,,,,,..   .*#&@@@@@
&&@@@@@@@@@@&/,,,,.                              .*(###(/**,*****////((((((((((((((((((((((((((((((((((((((((((((((((((################%%%%%%%%%%#(,..                       .*********,,,,.   .*#&@@@@@
&&@@@@@@@@@@&/,,,,..       ...                   .,/###(/*,,,,,**///((####((((///////////((((((##############################%%%%%%%%%%%%%%%%%%##/*.                         .,******,,,,,,.    *#&@@@@@
@@@@@@@@@@@@%/,,,,...   ...,,,.    ...        ...,*(###(/,,,,**/(((((((((((((((///**********///(((##%%##########((((((((((((((((###%%%%&&&%%#(*,,.                           ..,******,,,..     *#&@@@@@
@@@@@@@@@@@@&/*,,,....,,,,,,,,.    ....       .,,,*(%%#(*,,**//(((((((##%%%%###(//***,,,***///(((#######%%&&&%#####((/////*****//(%%%%&&&&%%(/,.                              .,*,,,...         *#&@@@@@
@@@@@@@@@@@@&/*,,...,,**,,,,,,.   .....       .,,,*(%%#/*,***///((###%%%%%%####(//***,,***////(((####(((#####(((((((((////******/(#%%%%%%%###(/*.                               .              .*#&@@@@@
@@@@@@@@@@@@&(*,,. .,,*,,,,.,,.   ...,.       ...,*(%%#/*,,**//(((((//(((((((((//*********/////((((((((//////////////////*******/(#%%%%%##(((((*,.                                             ./#&@@@@@
@@@@@@@@@@@@&(/,,. .,,,,,.....,.  ..,,.       ...,*(%%#/*,,**////*****//////////**********//////////////////////////************/(#%%%##(////((/,.                                             .(%&@@@@@
@@@@@@@@@@@@&#/... ..,,,,,.. ...  ..,,.          ,/(##(/*,***********//////**********,****///////////***//////******************//#%%%#(//*//((/,.                                             .#&&@@@@@
@@@@@@@@@@@@&%/     .,,,,,,........,..           ,/(##(/*,,***,********************,,,,***///////////****************************/#%%%##(//*///*..                                             .#&@@@@@@
@@@@@@@@@@@@@@(     .,,,,,,,....,,,,..           .*/(#(/*,,,,,,,,,,**************,,,,,,***/////////******************************/(###(#((/*//*,     .                                        .*%@@@@@@@
@@@@@@@@@@@@@@%*.    ,*,,,,,,...,,,..            .*//((/*,,,,,,,,,,************************///////////////***********************////((((////*..     .                                        *#&@@@@@@@
@@@@@@@@@@@@@@&%*    .*,,,,,,,,,,,,.             .,**/***,,,,,,,,,,***********************/////**//////((/////*******************///////////*.                                                (&&@@@@@@@
@@@@@@@@@@@@@@@&/.   .,,,,,,,,,,,..               .,*****,,,,,,,,*****/////////////***/////(((((((((((((((((//////***************/////**//*,.                                               .*#@@@@@@@@@
@@@@@@@@@@@@@@@@%/.  .,,,,,,,,,,..                 .,,****,,,,*****///(((//////((((/////(((((((((((((((////(((////////////*******/////***,.                                                 *#&@@@@@@@@@
@@@@@@@@@@@@@@@@&%*.  ..    ....                    .,,*********////(((///***//////((((((((((((((((((//////////(((//////////*****////**,..                ..,*///((((////*,.              .*#&@@@@@@@@@@
@@@@@@@@@@@@@@@@@&%/                                  .,,******///(((////*****/////((((((((((((((((((///////((((/((//////////////////*,.          ....*/%&@@@@@@@@@@@@@@@@@@@&#/,.        ,#&@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@&#*.                                 .,*****///(((/////******/////////////////////////////(((/////////////////////*,           ,/#%&&@@@@@@@@@@@@@@@@@@@@@@@@@&&%(*.   ,(%@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@&&/                                  .*****///((////////////////////((((((((((((((((((((#(((/////////////////////*.       .,/%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&#/,(&@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@%(.                                .******////////((#%%%%##(((((/((((((((/(((##%%&%%%##(//////////////////////**.     .*#&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@&/,                               .,*********///////(##%%##((////////(((/(######((///////////////////////////*,.....*#&@@@@@@@@@@@@@&&&&%%######%%%&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@&&#*.                              .,******************/////////((((((((((((////////////////////////////////**,.. ,(%@@@@@@@@@@@&&%%#(((((((((((((((((#%&&@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@&&(.                              .,*****//////***********///////////////////////////////////////////////**,   *(&@@@@@@@@@@&&#((((((((((((((((((((((((#%&@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@&%*.                              .,**////////**********/////////////////////////(((((////////////////***, ..#&&@@@@@@@@&&%((((((((((((((((((((((((((((#%&&@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@&#,.                             .,*//////////********/////////////////////////(((((((/////////////***/*,*/%@@@@@@@@@&%((((((((((((((((((((((((((((((((#&@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&#*,.                            .,*/////////**********/////////////////////((((((((/////////////**/((*(%&@@@@@@@@&%#(((((((((((((((((((((((((((((((((%&&@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&(*          .......,,,........ ..,*///////*****************/////**/////((((((((((////////////**///*.(@@@@@@@@@@&%#(((((((((((((((((((((((((((((((((#&&@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&#*.             .......  ..,,,,,,***////******************/////////(((((((((((((((((((///////*,...(@@@@@@@@@@&#((((((((((((((((((((((((((((((((((#&&@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%*.                        ...,,,**/////***********/////////////(((((((((((((((((((/////**,.....(@@@@@@@@@@&%#(((((((((((((((((((((((((((((((((#&&@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%(*.. .                        .,,*/////////////////////((((((((((((((####((((((////**,......./%&@@@@@@@@&%#(((((((((((((((((((((((((((((((((%&&@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&(,...........              ...,**/((((((((((((((((((((((((((########((((((((//*,..........,(%@@@@@@@@@&%((((((((((((((((((((((((((((((((#&@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&#/*..........              .,****//(((((((####((((((((((#######((((((((//*,,.............,#&&@@@@@@@@&&%((((((((((((((((((((((((((((#%&&@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%(,.........          ....,,****////((((((((((((((((((((((((((((((/,,..................*(&@@@@@@@@@@&&#(((((((((((((((((((((((((%&@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%#/*..         .......,********//////////(((((((((((((((((//*,,......................,(%@@@@@@@@@@@&&%%#(((((((((((((((((#%&&@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&#/,   .  .......,*/**,*****////////////////((((((//*,,............................*#&@@@@@@@@@@@@@&&&&%%######%%%&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%#/*,........,*///*,,****///////////////////*,,.................................,/#&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&%(*,...,,*//**,,,*************////**,....................................*/#&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%#((/((/*,,,,***************,..............................,,*/(##%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&%#(//*************,......................,*/(#%&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
`;
console.log(`ACKNOWLEDGEMENTS

Thanks to everyone who helped us dev this, especially Mikey, who introduced me to React.js (even though we didn't use it for this game). He also helped us by being extremely handsome :)
${handsome}

I'd also like to thank Spinz and XVO, also from Split Diamond Labs, for helping me through the tough times of lockdown by not doing much work and making me happy instead. 

Finally, I'd like to thank all of my family, friends and teachers, who helped guide me and the rest of the team through this game. 

Well, see you all in WotM II: SpeckCoin Incremental!

- Flyspeck101
`);

function importSave() {
  if (localStorage.getItem("darkMode")) toggleDark();
  if (localStorage.getItem("inventory")) { inventory = JSON.parse(localStorage.getItem("inventory")); notify("Save loaded successfully.") }
  if (localStorage.getItem("rooms")) rooms = JSON.parse(localStorage.getItem("rooms"));
  if (localStorage.getItem("currentRoom")) currentRoom = localStorage.getItem("currentRoom");
}

function exportSave(showMessages) {
  localStorage.setItem("darkMode", document.getElementsByClassName("body")[0].style.filter == "invert(1)");
  localStorage.setItem("inventory", JSON.stringify(inventory));
  localStorage.setItem("rooms", JSON.stringify(rooms));
  localStorage.setItem("currentRoom", currentRoom);
  if (showMessages) notify("Progress saved");
}

importSave();
let autoSave = setInterval(exportSave, 30000, true);

function setAutoSave(newInterval, showMessages) {
  clearInterval(autoSave);
  autoSave = setInterval(exportSave, newInterval, showMessages);
}

// Get the modal
var modal = document.getElementById("options");

// Get the button that opens the modal
var btn = document.getElementById("optionsButton");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

var slider = document.getElementById("autoSave");

// Update the current slider value (each time you drag the slider handle)
slider.oninput = function() {
  document.getElementById("output").innerText = "" + Math.floor(this.value / 10) + "." + this.value % 10;
  setAutoSave(this.value * 100, true);
}

refresh();